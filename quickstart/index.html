



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://charlesreid1.github.io/2019-snakemake-byok8s/quickstart/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching pages">
      
        <meta name="lang:search.result.one" content="1 matching page">
      
        <meta name="lang:search.result.other" content="# matching page">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="..">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.3">
    
    
      
        <title>Quickstart - 2019-snakemake-byok8s</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#quickstart" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://charlesreid1.github.io/2019-snakemake-byok8s" title="2019-snakemake-byok8s" class="md-header-nav__button md-logo">
          
            <img src="../images/ship.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                2019-snakemake-byok8s
              </span>
              <span class="md-header-nav__topic">
                Quickstart
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search this site" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching this site
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/charlesreid1/2019-snakemake-byok8s" title="Go to repository" class="md-source" data-md-source="github">
    
    <div class="md-source__repository">
      2019-snakemake-byok8s
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://charlesreid1.github.io/2019-snakemake-byok8s" title="2019-snakemake-byok8s" class="md-nav__button md-logo">
      
        <img src="../images/ship.svg" width="48" height="48">
      
    </a>
    2019-snakemake-byok8s
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/charlesreid1/2019-snakemake-byok8s" title="Go to repository" class="md-source" data-md-source="github">
    
    <div class="md-source__repository">
      2019-snakemake-byok8s
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Index" class="md-nav__link">
      Index
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installing/" title="Installing" class="md-nav__link">
      Installing
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Quickstart
      </label>
    
    <a href="./" title="Quickstart" class="md-nav__link md-nav__link--active">
      Quickstart
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-set-up-virtual-kubernetes-cluster" title="Step 1: Set Up Virtual Kubernetes Cluster" class="md-nav__link">
    Step 1: Set Up Virtual Kubernetes Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-install-byok8s" title="Step 2: Install byok8s" class="md-nav__link">
    Step 2: Install byok8s
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-run-byok8s" title="Step 3: Run byok8s" class="md-nav__link">
    Step 3: Run byok8s
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-tear-down-kubernetes-cluster" title="Step 4: Tear Down Kubernetes Cluster" class="md-nav__link">
    Step 4: Tear Down Kubernetes Cluster
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../kubernetes_minikube/" title="K8s with Minikube" class="md-nav__link">
      K8s with Minikube
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../kubernetes_gcp/" title="K8s with GCP" class="md-nav__link">
      K8s with GCP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../kubernetes_aws/" title="K8s with AWS" class="md-nav__link">
      K8s with AWS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../kubernetes_dok/" title="K8s with DigitalOcean" class="md-nav__link">
      K8s with DigitalOcean
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../travis_tests/" title="Travis Tests" class="md-nav__link">
      Travis Tests
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-set-up-virtual-kubernetes-cluster" title="Step 1: Set Up Virtual Kubernetes Cluster" class="md-nav__link">
    Step 1: Set Up Virtual Kubernetes Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-install-byok8s" title="Step 2: Install byok8s" class="md-nav__link">
    Step 2: Install byok8s
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-run-byok8s" title="Step 3: Run byok8s" class="md-nav__link">
    Step 3: Run byok8s
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-tear-down-kubernetes-cluster" title="Step 4: Tear Down Kubernetes Cluster" class="md-nav__link">
    Step 4: Tear Down Kubernetes Cluster
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="quickstart">Quickstart<a class="headerlink" href="#quickstart" title="Permanent link">&para;</a></h1>
<p>This runs through the installation and usage 
of <code>2019-snakemake-byok8s</code>.</p>
<p>Step 1: Set up Kubernetes cluster with <code>minikube</code>.</p>
<p>Step 2: Install <code>byok8s</code>.</p>
<p>Step 3: Run the <code>byok8s</code> workflow using the Kubernetes cluster. </p>
<p>Step 4: Tear down Kubernetes cluster with <code>minikube</code>.</p>
<h2 id="step-1-set-up-virtual-kubernetes-cluster">Step 1: Set Up Virtual Kubernetes Cluster<a class="headerlink" href="#step-1-set-up-virtual-kubernetes-cluster" title="Permanent link">&para;</a></h2>
<p>For the purposes of the quickstart, we will walk
through how to set up a local, virtual Kubernetes
cluster using <code>minikube</code>.</p>
<p>Start by installing minikube:</p>
<div class="codehilite"><pre><span></span>scripts/install_minikube.sh
</pre></div>


<p>Once it is installed, you can start up a kubernetes cluster
with minikube using the following commands:</p>
<div class="codehilite"><pre><span></span>cd test
minikube start
</pre></div>


<p>NOTE: If you are running on AWS, run this command first</p>
<div class="codehilite"><pre><span></span>minikube config set vm-driver none
</pre></div>


<p>to set the the vm driver to none and use native Docker to run stuff.</p>
<p>If you are running on AWS, the DNS in the minikube
kubernetes cluster will not work, so run this command
to fix the DNS settings (should be run from the
<code>test/</code> directory):</p>
<div class="codehilite"><pre><span></span>kubectl apply -f fixcoredns.yml
kubectl delete --all pods --namespace kube-system
</pre></div>


<h2 id="step-2-install-byok8s">Step 2: Install byok8s<a class="headerlink" href="#step-2-install-byok8s" title="Permanent link">&para;</a></h2>
<p>Start by setting up a python virtual environment,
and install the required packages into the
virtual environment:</p>
<div class="codehilite"><pre><span></span>pip install -r requirements.txt
</pre></div>


<p>This installs snakemake and kubernetes Python
modules. Now install the <code>byok8s</code> command line
tool:</p>
<div class="codehilite"><pre><span></span>python setup.py build install
</pre></div>


<p>Now you can run:</p>
<div class="codehilite"><pre><span></span>which byok8s
</pre></div>


<p>and you should see <code>byok8s</code> in your virtual 
environment's <code>bin/</code> directory.</p>
<p>This command line utility will expect a kubernetes
cluster to be set up before it is run. </p>
<p>Setting up a kubernetes cluster will create...
(fill in more info here)...</p>
<p>Snakemake will automatically create the pods
in the cluster, so you just need to allocate
a kubernetes cluster.</p>
<h2 id="step-3-run-byok8s">Step 3: Run byok8s<a class="headerlink" href="#step-3-run-byok8s" title="Permanent link">&para;</a></h2>
<p>Now you can run the workflow with the <code>byok8s</code> command.
This submits the Snakemake workflow jobs to the Kubernetes
cluster that minikube created.</p>
<p>You should have your workflow in a <code>Snakefile</code> in the
current directory. Use the <code>--snakefile</code> flag if it is
named something other than <code>Snakefile</code>.</p>
<p>You will also need to specify your AWS credentials
via the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>
environment variables. These are used to to access
S3 buckets for file I/O.</p>
<p>Finally, you will need to create an S3 bucket for
Snakemake to use for file I/O. Pass the name of the
bucket using the <code>--s3-bucket</code> flag.</p>
<p>Start by exporting these two vars (careful to
scrub them from bash history):</p>
<div class="codehilite"><pre><span></span>export AWS_ACCESS_KEY_ID=XXXXX
export AWS_SECRET_ACCESS_KEY=XXXXX
</pre></div>


<p>Run the alpha workflow with blue params:</p>
<div class="codehilite"><pre><span></span>byok8s --s3-bucket=mah-bukkit workflow-alpha params-blue
</pre></div>


<p>Run the alpha workflow with red params:</p>
<div class="codehilite"><pre><span></span>byok8s --s3-bucket=mah-bukkit workflow-alpha params-red
</pre></div>


<p>Run the gamma workflow with red params, &amp;c:</p>
<div class="codehilite"><pre><span></span>byok8s --s3-bucket=mah-bukkit workflow-gamma params-red
</pre></div>


<p>(NOTE: May want to let the user specify 
input and output directories with flags.)</p>
<p>All input files are searched for relative to the working
directory.</p>
<h2 id="step-4-tear-down-kubernetes-cluster">Step 4: Tear Down Kubernetes Cluster<a class="headerlink" href="#step-4-tear-down-kubernetes-cluster" title="Permanent link">&para;</a></h2>
<p>The last step once the workflow has been finished,
is to tear down the kubernetes cluster. The virtual
kubernetes cluster created by minikube can be torn
down with the following command:</p>
<div class="codehilite"><pre><span></span>minikube stop
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../installing/" title="Installing" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Installing
              </span>
            </div>
          </a>
        
        
          <a href="../kubernetes_minikube/" title="K8s with Minikube" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                K8s with Minikube
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 <a href="https://charlesreid1.com">Charles Reid</a>, released under the <a href="https://opensource.org/licenses/MIT">MIT license</a> <br /><br /> <div>Icon made by Freepik, obtained from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>, used under a <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div> license.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../search/main.js"></script>
      
    
    
      
    
  </body>
</html>